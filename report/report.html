<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/styles.css">
    <title>Document</title>
</head>
<body>
    <h1>SBA Loan Approval Analysis Data Exploration</h1>
    <p>
        In this assignment we were provided with historical data from 1987 to 2014 from the U.S. Small Business Administration 
        (SBA) with 899,164 observations. Each observation represents a loan that was guaranteed to some degree
        by the SBA and showed wheater each loan was paid in full or defaulted. This document is a summary of our research, code and explanation can be found in the jupyter and R markdown files
    </p>
    <h2>Introduction</h2>
    <p>
        We choose to look at the obeservations between 2000-2010. We choose this timeframe so that our data more accurately reflected
        the present and because we believed that the inclusion of loans past 2010 since the time restriction on the loans may introduce
        selection bias towards loans that defaulted since loans that were paid in full would go beyond the timeframe and be excluded from
        the dataset.
    </p>
    <p>
        Using R We began by looking at loans disbursed during the Great Recession (2008-2009) to determine wheater or not the variance 
        caused by the recession was high enough to warrant excluding the data from our research.
    </p>
    <p> 
        We observed that there was a significant difference in the default rate of loans active during the recession vs the rest of the 
        dataset. We see that loans that occured during the recession had a default rate of 36.94% compared to loans that didn't occur
        during the recession with a 26.69% default rate, a 10.25% difference. Our p-value was &lt; 2.2e-16 confirming that these results
        were statistically significant. The interactive graph below provides a visual representation of our research.
    </p>
    <div class="iframe-container"><iframe src="graphs/recession.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h2>Variable Analysis</h2>
    <p>
        We ended up with 279,860 loans, with 74,704 of these loans defaulting leading to a default rate of 26.69%. We identified 
        12 variables that may be a possible predictor for loan default rates and provided an analysis for each one below. 
    </p>
    <p>The 12 variables were:</p>
    <li>Business State</li>
    <li>Business Industry</li>
    <li>Franchised vs Non-Franchised Businesses</li>
    <li>New vs Existing Businesses</li>
    <li>Urban vs Rural Businesses</li>
    <li>Loans Backed by Real Estate</li>
    <li>Businesses with a Revolving Line of Credit</li>
    <li>Loans in the LowDoc Loan Program</li>
    <li>Number of Employees</li>
    <li>Loan Term Length</li>
    <li>Gross Disbursement</li>
    <li>Proportion of Loan Guaranteed by the SBA</li>
    <h3>State</h3>
    <p>
        The three states with the lowest default rate were Wyoming with a 8.56% default rate, North Dakota with a 8.86% default rate, 
        and Montana with a 10.79% default rate. The three states with the highest default rates were Neveda with a 37.33% default rate, 
        Georgia with a 36.86% default rate, and Arizona with a 36.25% default rate. Each state has differing economic enviornments which
        as a result leads to a very wide range of default rates across different states. Below is a heatmap of the default rates in different states.
    </p>
    <div class="iframe-container"><iframe src="graphs/state.html" width="70%" height="600" frameborder="0"></iframe></div>
    <h3>Industry</h3>
    <p>
        The three industries with the lowest default rate were Mining, Quarry, and Oil and Gas Extraction with a 12.71% defualt rate, 
        Health Care and Social Assistance with a 14.52% default rate, and Agriculture, Forestry, Fishing and Hunting with a 16.68% default rate. 
        The three industries with the highest default rate are Real Estate and Rental and Leasing with a 37.87% default rate, 
        Finance and Insurance with a 33.96% default rate, and Transportation and Warehousing with a 32.27% default rate. There are multiple reasons
        why the default rates may fluctuate between industries which we will not be able to delve into here but, one major one we will highlight is the barrier to entry for each industry. 
        An industry like Mining, Quarry, and Oil and Gas Extraction would have to be well funded and established just to get started as you would need to buy lots of tools and 
        obtain the necessary license and permits which leads to default rates in the industry tending to be on the lower side. Below is a barchart of default rates of each industry
    </p>
    <div class="iframe-container"><iframe src="graphs/industry.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Franchise</h3>
    <p>
        We believed weather or not a business was franchised would be a possible predictor since if a business is franchised since franchised businesses would have higher recognition, proven business model, 
        and support compared to a non-franchised business like a small family owned bakery. We see that the difference in default rate is noticable wtih non-franchised business having a default rate of 28.39% and 
        franchised businesses having a default rate of 20.23%, a 8.16% difference. Below is a barchart of default rates of franchised vs non-franchised businesses.
    </p>
    <div class="iframe-container"><iframe src="graphs/franchise.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>New vs Existing Businesses</h3>
    <p>
        We believed weather or not a business had been existing (existing for more that 2 years) would be a possible predictor since if a business has been existing for a while it could be an indicator
        that the business is doing good and they would be more likely to pay off the loan compared to a newly established business. Our anaylsis shows that the difference in default rate is actually very
        miniscule with new business having a 27.40% default rate and existing businesses with a 28.41% default rate. Below is a barchart of default rates of new vs exisiting businesses.
    </p>
    <div class="iframe-container"><iframe src="graphs/new.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Urban vs Rural Businessess</h3>
    <p>
        Since urban and rural businesses work under very different economic enviornments we believed that it could be a possible indicator. Our analysis shows that there is a noticable difference between 
        urban and rural businesses with urban business having a 29.53% default rate and rural businesses having a 21.82% default rate, a 7.72% difference. Below is a barchart of default rates of urban vs rural businesses.
    </p>
    <div class="iframe-container"><iframe src="graphs/urban.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Loans Backed by Real Estate</h3>
    <p>
        If a loan is backed by real estate the value of the land would help in paying off the loan so we believed that it oculd be a possible indicator. Our analysis shows that there is a very 
        significant difference between loans backed by real estate vs those that are not. Loans that are not backed by real estate have a default rate of 30% while loans backed by real estate have a default rate 
        of 2.24%, a 27.76% difference. Below is a barchart of default rates of loans backed by real estate vs those that are not.
    </p>
    <div class="iframe-container"><iframe src="graphs/realestate.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Revolving Line of Credit</h3>
    <p>
        With a revolving line of credit businesses have access to readily avaliable cash that would smooth out business operations, like covering unexpected expenses. Because of this we beleived that 
        weather or not a business had a revolving line of credit could be a possible indicator. Our anylsis shows that there is a small difference with loans given to businesses with a revovling line of credit
        having a 29.19% default rate while loans given to businesses with a revolving line of credit have a 27.29% default rate. Below is a barchart of default rates of businesses with a revolving line of credit vs those without one.
    </p>
    <div class="iframe-container"><iframe src="graphs/credit.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>LowDoc loan program</h3>
    <p>
        The LowDoc loan program requires solid credit history, which would mean businesses that are in the LowDoc loan program could be considered a more "reliable" lender. This means that 
        the LowDoc loan program could be a possible indicator. Our anaylsis shows that there is a noticable difference with loans in the LowDoc program vs those that are not. Loan that aren't in the LowDoc program have a 
        defualt rate of 28.18% while loans not in the LowDoc program have a a default rate of 16.49%, a 11.69% difference. Below is a barchart of default rates of loans in the LowDoc program vs those that are not in it.
    </p>
    <div class="iframe-container"><iframe src="graphs/lowdoc.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Number of Employees</h3>
    <p>
        We believed the number of employees would be an important variable as more employees may indicate that a business is well established and would be more likely to not
        default on their loan. In our analysis we saw that in loans that were paid in full the mean employee count for the business was 8.59 while the  in loans that were defaulted on 
        the mean employee count was 5.54. Below is a barchart that displays the distribution of number of employees by quartile of loans that were paid in full vs defaulted.
    </p>
    <div class="iframe-container"><iframe src="graphs/emp.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Loan Term Length</h3>
    <p>
        We believed that loan term length would be an important indicator as loans with because if the business had more time to pay off their loan they would be more likely to be
        able to. In our anaylsis we saw the loans that were paid in full had a mean term length of 93.79 months compared to loan that were paid in full which had a mean term length of 
        48.16 months. Below is a histogram that shows the distribution of loan term length of loans that were paid in full vs defaulted.
    </p>
    <div class="iframe-container"><iframe src="graphs/term.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Gross Disbursement</h3>
    <p>
        We choose to look at the gross disbursement of the loan as we believed that a larger loan size would indicate that a business is already well established and 
        looking to expand so they would be in a good place to properly pay off the loan. We did observe that the mean disbursement gross for loans that were paid in full 
        ($169,662.30) was larger than the mean disbursement gross for loans that were defaulted ($10038.40). Below is a barchart that displays the distribution of gross disbursement
        by quartile of loans that were paid in full vs defaulted.
    </p>
    <div class="iframe-container"><iframe src="graphs/disbursement.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h3>Proportion of loan covered by the SBA</h3>
    <p>
        We looked at the propotion of the loan covered by the SBA because we believed that when a higher proportion of the loan is covered by the SBA, it would reduce the 
        probability of default since some of the loan is being guaranteed to be paid. In our anaylsis we saw that the mean SBA gauranteed percentage of 
        loans that were paid in full (59.90%) was slightly higher than the loans that were defaulted (57.82%). Below is a histogram that shows the distribution of SBA gauranteed percentage 
        of loans that were paid in full vs defaulted.
    <div class="iframe-container">  <iframe src="graphs/sbaproportion.html" width="60%" height="600" frameborder="0"></iframe></div>
    <h2>Modeling</h2>
    <p>
        After our variable analysis we choose 10 variables to use as predictors for loan default rates. The 10 variables were: business state, business industry, franchised vs non-franchised businesses, 
        urban vs rural businesses, loans backed by real estate, loans in the LowDoc program, number of employees, loan term length, gross disbursement, and proportion gauranteed by SBA.
    </p>
    <p>
        Using a train test split of 80/20 We went through a broad range of models and compared them to each other so that we could develop the most accurate model. 
        Below is the ROC curve of each model that we went through. Additional graphs like lift and gain charts can be found in the jupyter notebook.
    </p>
    <div class="iframe-container"> <img src="graphs/models.png" width="40%" height="600" frameborder="0"></iframe></div>
    <p>
        CatBoost would end up being our most accurate model with the highest cost matrix. After optimizing hyperparameters for f1-scoring (priotizing f1-scoring because it would account for our inbalanced dataset) we would end up with
        an accuracy of 93%. We also calculated that the most profitable threshold value for the model would be 0.32. Below is a graph of the threshold value on the ROC curve of the CatBoost model.
        <div class="iframe-container"> <img src="graphs/threshold.png" width="40%" height="600" frameborder="0"></iframe></div>
    </p>
    <p>
        Using SHAP we looked at what variables were the most impactful on the models decision. Below is a graph of all the SHAP values from our test data.
    </p>
    <div class="iframe-container"> <img src="graphs/shap.png" width="40%" height="600" frameborder="0"></iframe></div>
    <p>We created a form to test out the model on https://businesscomp.streamlit.app/ </p>
</body>
</html>